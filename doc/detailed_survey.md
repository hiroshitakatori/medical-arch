# システム詳細調査結果

## 詳細調査項目

| カテゴリ | 項目 | 状況 | 詳細 | パス/値 | 優先度 | 対応工数 | 備考 |
|---------|------|------|------|---------|--------|----------|------|
| システム構成 | アプリケーションの場所 | 正常 | バックエンドAPI | `/medical-arc/medical-arch-call-system-backend` | 低 | 0時間 | メインアプリケーション |
| システム構成 | 施設管理フロント | 正常 | 施設用フロントエンド | `/medical-arc/on-call-system-facility` | 低 | 0時間 | React + Ant Design |
| システム構成 | スタッフ用フロント | 正常 | スタッフ用フロントエンド | `/var/www/medical-arch.com` | 低 | 0時間 | React + Ant Design |
| プロセス管理 | PM2プロセス1 | 正常 | バックエンドAPI | ポート8001 | 低 | 0時間 | `npm start api` |
| プロセス管理 | PM2プロセス2 | 正常 | 施設管理フロント | ポート3001 | 低 | 0時間 | `npx serve -s build -p 3001` |
| プロセス管理 | PM2プロセス3 | 正常 | スタッフ用フロント | ポート3002 | 低 | 0時間 | `npx serve -s build -p 3002` |
| 設定 | NODE_ENV設定 | 要改善 | 環境変数未設定 | 未設定 | 中 | 0.5時間 | production.jsonから読み込み |
| 設定 | PORT設定 | 正常 | サーバーポート | 8001 | 低 | 0時間 | production.jsonから読み込み |
| 設定 | 設定ファイル | 正常 | 本番設定ファイル | `/medical-arc/medical-arch-call-system-backend/config/production.json` | 低 | 0時間 | 機密情報含む |
| データベース | Redis接続 | 正常 | キャッシュサーバー | PONG応答 | 低 | 0時間 | localhost:6379 |
| データベース | MongoDB接続 | 要確認 | メインデータベース | 接続未確認 | 中 | 1時間 | mongoクライアント未インストール |
| 外部サービス | Twilio連携 | 正常 | 音声通話サービス | API応答正常 | 低 | 0時間 | アカウント有効 |
| 外部サービス | SendGrid連携 | 正常 | メール送信サービス | API応答正常 | 低 | 0時間 | 有料アカウント |
| ログ管理 | アプリケーションログ | 要改善 | アプリケーション専用ログ | ログディレクトリなし | 高 | 1時間 | セキュリティ監視のため必要 |
| ログ管理 | PM2ログ | 正常 | プロセス管理ログ | `/root/.pm2/logs/` | 低 | 0時間 | 正常に記録されている |
| ログ管理 | Nginxログ | 要改善 | Webサーバーログ | アクセスログなし | 高 | 1時間 | 攻撃監視のため必要 |
| ログ管理 | システムログ | 正常 | システムログ | journalctlで確認可能 | 低 | 0時間 | 正常に記録されている |
| バックアップ | Cron設定 | 要改善 | 自動バックアップ設定 | 設定なし | 中 | 2時間 | アプリケーションレベル |
| バックアップ | システムバックアップ | 正常 | システムレベルバックアップ | `/var/backups/` | 低 | 0時間 | 自動実行中 |
| バックアップ | アプリケーションバックアップ | 要改善 | アプリケーションレベルバックアップ | 設定なし | 中 | 2時間 | データ保護のため必要 |
| バックアップ | MongoDBバックアップ | 要確認 | データベースバックアップ | 未確認 | 中 | 1時間 | クライアント未インストール |
| Webサーバー | Nginx設定 | 正常 | Webサーバー設定 | `/etc/nginx/sites-available/medical-arch` | 低 | 0時間 | 適切な設定 |
| Webサーバー | SSL証明書 | 正常 | SSL証明書 | Let's Encrypt証明書有効 | 低 | 0時間 | 調査時点で有効 |
| Webサーバー | ドメイン設定 | 正常 | ドメイン設定 | 3つのサブドメイン設定済み | 低 | 0時間 | medical-arch.com等 |
| Webサーバー | リバースプロキシ | 正常 | リバースプロキシ設定 | 適切な設定 | 低 | 0時間 | ポート転送正常 |
| セキュリティ | UFWファイアウォール | 正常 | ファイアウォール設定 | ポート80,10022のみ開放 | 低 | 0時間 | 適切な設定 |
| セキュリティ | iptables | 正常 | iptables設定 | UFWで管理 | 低 | 0時間 | 適切な設定 |
| セキュリティ | ブロックされたIP | 正常 | 攻撃IPブロック | 171.107.14.49,45.135.232.92 | 低 | 0時間 | 攻撃IPを適切にブロック |
| セキュリティ | 攻撃の痕跡 | 要注意 | 攻撃の痕跡 | PM2ログでWordPress攻撃の痕跡 | 高 | 2時間 | セキュリティ強化が必要 |
| メンテナンス | PM2バージョン | 要改善 | PM2バージョン | 古いバージョン | 中 | 0.5時間 | 6.0.13にアップデート推奨 |
| メンテナンス | Node.js警告 | 要改善 | Node.js警告 | `Buffer()`の非推奨警告 | 中 | 1時間 | コード修正が必要 |
| メンテナンス | MongoDB警告 | 要改善 | MongoDB警告 | `collection.remove`の非推奨警告 | 中 | 1時間 | コード修正が必要 |

## 調査日

2025年10月（引き継ぎ時）

